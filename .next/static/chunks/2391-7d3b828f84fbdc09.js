"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2391],{2391:function(e,t,r){r.d(t,{tN:function(){return c},ML:function(){return l},r$:function(){return n}});var s=r(9625),a=r(6885);let i={priceRange:[0,5e3],airlines:[],stops:[0,1,2],durationRange:[0,1440],departureTimeRanges:[{label:"Morning",start:"06:00",end:"12:00"},{label:"Afternoon",start:"12:00",end:"18:00"},{label:"Evening",start:"18:00",end:"24:00"},{label:"Night",start:"00:00",end:"06:00"}],arrivalTimeRanges:[{label:"Morning",start:"06:00",end:"12:00"},{label:"Afternoon",start:"12:00",end:"18:00"},{label:"Evening",start:"18:00",end:"24:00"},{label:"Night",start:"00:00",end:"06:00"}],airports:[],directFlightsOnly:!1,ecoFriendlyOnly:!1},n=(0,s.Ue)()((0,a.tJ)((e,t)=>({searchParams:null,searchResults:[],loading:!1,error:null,hasSearched:!1,filters:i,sortBy:"best",viewMode:"list",selectedFlights:[],comparisonFlights:[],currentPage:1,totalPages:1,totalResults:0,resultsPerPage:10,searchHistory:[],recentSearches:[],savedSearches:[],setSearchParams:t=>e({searchParams:t,hasSearched:!0,currentPage:1,selectedFlights:[]}),updateSearchParams:t=>e(e=>({searchParams:e.searchParams?{...e.searchParams,...t}:null})),setSearchResults:function(r){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.length;return e({searchResults:r,totalResults:s,currentPage:1,totalPages:Math.ceil(s/t().resultsPerPage),loading:!1,error:null,hasSearched:!0})},appendSearchResults:(t,r)=>e(e=>{let s=[...e.searchResults,...t];return{searchResults:s,totalResults:r||s.length,loading:!1}}),setLoading:t=>e({loading:t}),setError:t=>e({error:t,loading:!1}),clearSearch:()=>e({searchParams:null,searchResults:[],selectedFlights:[],comparisonFlights:[],currentPage:1,totalPages:1,totalResults:0,hasSearched:!1,error:null,filters:i}),setFilters:t=>e({filters:t}),updateFilters:t=>e(e=>({filters:{...e.filters,...t},currentPage:1})),clearFilters:()=>e({filters:i}),resetFiltersToDefaults:()=>e({filters:i}),setSortBy:t=>e({sortBy:t,currentPage:1}),setViewMode:t=>e({viewMode:t}),selectFlight:t=>e(e=>({selectedFlights:[...e.selectedFlights.filter(e=>e.id!==t.id),t]})),deselectFlight:t=>e(e=>({selectedFlights:e.selectedFlights.filter(e=>e.id!==t)})),toggleFlightSelection:t=>e(e=>e.selectedFlights.some(e=>e.id===t.id)?{selectedFlights:e.selectedFlights.filter(e=>e.id!==t.id)}:{selectedFlights:[...e.selectedFlights,t]}),clearSelectedFlights:()=>e({selectedFlights:[]}),selectMultipleFlights:t=>e({selectedFlights:t}),addToComparison:t=>e(e=>e.comparisonFlights.length>=4?e:e.comparisonFlights.some(e=>e.id===t.id)?e:{comparisonFlights:[...e.comparisonFlights,t]}),removeFromComparison:t=>e(e=>({comparisonFlights:e.comparisonFlights.filter(e=>e.id!==t)})),clearComparison:()=>e({comparisonFlights:[]}),toggleComparison:t=>e(e=>e.comparisonFlights.some(e=>e.id===t.id)?{comparisonFlights:e.comparisonFlights.filter(e=>e.id!==t.id)}:e.comparisonFlights.length<4?{comparisonFlights:[...e.comparisonFlights,t]}:e),setCurrentPage:t=>e({currentPage:t}),nextPage:()=>e(e=>({currentPage:Math.min(e.currentPage+1,e.totalPages)})),previousPage:()=>e(e=>({currentPage:Math.max(e.currentPage-1,1)})),setResultsPerPage:t=>e(e=>({resultsPerPage:t,totalPages:Math.ceil(e.totalResults/t),currentPage:1})),addToSearchHistory:(t,r)=>e(e=>({searchHistory:[{id:Date.now().toString(),params:t,timestamp:Date.now(),resultCount:r},...e.searchHistory.slice(0,49)]})),addToRecentSearches:(t,r,s)=>e(e=>{let a=e.recentSearches.filter(e=>!(e.from===t&&e.to===r&&e.date===s));return{recentSearches:[{from:t,to:r,date:s},...a.slice(0,9)]}}),saveSearch:function(t,r){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e(e=>{let a={id:Date.now().toString(),name:t,params:r,alerts:s};return{savedSearches:[...e.savedSearches,a]}})},deleteSavedSearch:t=>e(e=>({savedSearches:e.savedSearches.filter(e=>e.id!==t)})),toggleSearchAlerts:t=>e(e=>({savedSearches:e.savedSearches.map(e=>e.id===t?{...e,alerts:!e.alerts}:e)})),loadSavedSearch:e=>{let r=t().savedSearches.find(t=>t.id===e);r&&t().setSearchParams(r.params)},clearSearchHistory:()=>e({searchHistory:[]}),clearRecentSearches:()=>e({recentSearches:[]}),getFilteredResults:()=>{let e=t(),r=e.searchResults;return(r=r.filter(t=>!(t.price.total<e.filters.priceRange[0])&&!(t.price.total>e.filters.priceRange[1])&&(!(e.filters.airlines.length>0)||!!e.filters.airlines.includes(t.airline.code))&&(!(e.filters.stops.length>0)||!!e.filters.stops.includes(t.stops))&&!(t.totalDuration<e.filters.durationRange[0])&&!(t.totalDuration>e.filters.durationRange[1])&&(!e.filters.directFlightsOnly||!(t.stops>0))&&(!e.filters.ecoFriendlyOnly||!!t.isEcoFriendly)&&(!(e.filters.airports.length>0)||!!t.legs.some(t=>e.filters.airports.includes(t.from.code)||e.filters.airports.includes(t.to.code))))).sort((t,r)=>{switch(e.sortBy){case"price-low":return t.price.total-r.price.total;case"price-high":return r.price.total-t.price.total;case"duration":return t.totalDuration-r.totalDuration;case"departure-early":return new Date(t.legs[0].departure).getTime()-new Date(r.legs[0].departure).getTime();case"departure-late":return new Date(r.legs[0].departure).getTime()-new Date(t.legs[0].departure).getTime();case"arrival-early":let s=t.legs[t.legs.length-1].arrival,a=r.legs[r.legs.length-1].arrival;return new Date(s).getTime()-new Date(a).getTime();case"arrival-late":let i=t.legs[t.legs.length-1].arrival;return new Date(r.legs[r.legs.length-1].arrival).getTime()-new Date(i).getTime();default:return 0}}),r},getSelectedFlightsCount:()=>t().selectedFlights.length,getComparisonFlightsCount:()=>t().comparisonFlights.length,getTotalPrice:()=>t().selectedFlights.reduce((e,t)=>e+t.price.total,0),getAveragePrice:()=>{let e=t().searchResults;return e.length>0?e.reduce((e,t)=>e+t.price.total,0)/e.length:0},getPriceRange:()=>{let e=t().searchResults;if(0===e.length)return[0,0];let r=e.map(e=>e.price.total);return[Math.min(...r),Math.max(...r)]},getUniqueAirlines:()=>Array.from(new Set(t().searchResults.map(e=>e.airline.code))),getUniqueAirports:()=>{let e=new Set;return t().searchResults.forEach(t=>{t.legs.forEach(t=>{e.add(t.from.code),e.add(t.to.code)})}),Array.from(e)},hasActiveFilters:()=>{let e=t();return e.filters.airlines.length>0||e.filters.stops.length<3||e.filters.airports.length>0||e.filters.directFlightsOnly||e.filters.ecoFriendlyOnly||e.filters.priceRange[0]>0||e.filters.priceRange[1]<5e3}}),{name:"flight-search-storage",partialize:e=>({searchHistory:e.searchHistory,recentSearches:e.recentSearches,savedSearches:e.savedSearches,viewMode:e.viewMode,resultsPerPage:e.resultsPerPage})})),o=["flights","passengers","seats","extras","payment","review"],l=(0,s.Ue)()((0,a.tJ)((e,t)=>({selectedFlights:[],passengers:[],seats:[],extras:{baggage:[],meals:[],insurance:void 0,priorityBoarding:!1,extraLegroom:!1,wifiAccess:!1,loungeAccess:!1,seatSelection:!1},payment:{},currentStep:"flights",completedSteps:[],validationErrors:{},isDirty:!1,isDraft:!0,draftId:void 0,lastSaved:void 0,autoSaveEnabled:!0,basePrice:0,taxes:0,fees:0,totalAmount:0,currency:"USD",status:"draft",selectFlight:t=>e(e=>{if(e.selectedFlights.some(e=>e.id===t.id))return e;let r=[...e.selectedFlights,t];return{selectedFlights:r,isDirty:!0,basePrice:r.reduce((e,t)=>e+t.price.total,0)}}),removeFlight:t=>e(e=>{let r=e.selectedFlights.filter(e=>e.id!==t);return{selectedFlights:r,seats:e.seats.filter(e=>e.flightId!==t),isDirty:!0,basePrice:r.reduce((e,t)=>e+t.price.total,0)}}),updateFlight:(t,r)=>e(e=>({selectedFlights:e.selectedFlights.map(e=>e.id===t?{...e,...r}:e),isDirty:!0})),clearSelectedFlights:()=>e({selectedFlights:[],seats:[],basePrice:0,isDirty:!0}),setSelectedFlights:t=>e({selectedFlights:t,basePrice:t.reduce((e,t)=>e+t.price.total,0),isDirty:!0}),addPassenger:()=>e(e=>{let t={id:"passenger_".concat(Date.now()),frequentFlyer:[],specialAssistance:[]};return{passengers:[...e.passengers,t],isDirty:!0}}),updatePassenger:(t,r)=>e(e=>({passengers:e.passengers.map(e=>e.id===t?{...e,...r}:e),isDirty:!0})),removePassenger:t=>e(e=>{var r,s;return{passengers:e.passengers.filter(e=>e.id!==t),seats:e.seats.filter(e=>e.passengerId!==t),extras:{...e.extras,baggage:(null===(r=e.extras.baggage)||void 0===r?void 0:r.filter(e=>e.passengerId!==t))||[],meals:(null===(s=e.extras.meals)||void 0===s?void 0:s.filter(e=>e.passengerId!==t))||[]},isDirty:!0}}),setPassengers:t=>e({passengers:t,isDirty:!0}),validatePassengers:()=>{let e=t(),r={};return 0!==e.passengers.length&&(e.passengers.forEach((e,t)=>{let s=[];e.firstName||s.push("First name is required"),e.lastName||s.push("Last name is required"),e.dateOfBirth||s.push("Date of birth is required"),e.gender||s.push("Gender is required"),e.contact&&(e.contact.email||s.push("Email is required"),e.contact.phone||s.push("Phone is required")),s.length>0&&(r["passenger_".concat(t)]=s)}),0===Object.keys(r).length)},addSeat:t=>e(e=>({seats:[...e.seats.filter(e=>!(e.passengerId===t.passengerId&&e.flightId===t.flightId)),t],isDirty:!0})),updateSeat:(t,r)=>e(e=>({seats:e.seats.map(e=>e.id===t?{...e,...r}:e),isDirty:!0})),removeSeat:t=>e(e=>({seats:e.seats.filter(e=>e.id!==t),isDirty:!0})),clearSeats:()=>e({seats:[],isDirty:!0}),setSeats:t=>e({seats:t,isDirty:!0}),updateExtras:t=>e(e=>({extras:{...e.extras,...t},isDirty:!0})),addBaggage:(t,r,s)=>e(e=>{let a=[...e.extras.baggage||[]];return a.push({passengerId:t,type:"checked",weight:r,price:s}),{extras:{...e.extras,baggage:a},isDirty:!0}}),removeBaggage:(t,r)=>e(e=>{var s;let a=null===(s=e.extras.baggage)||void 0===s?void 0:s.filter((e,s)=>!(e.passengerId===t&&s===r));return{extras:{...e.extras,baggage:a},isDirty:!0}}),addMeal:(t,r)=>e(e=>{let s=[...e.extras.meals||[]];return s.push({passengerId:t,...r}),{extras:{...e.extras,meals:s},isDirty:!0}}),removeMeal:(t,r)=>e(e=>{var s;let a=null===(s=e.extras.meals)||void 0===s?void 0:s.filter((e,s)=>!(e.passengerId===t&&s===r));return{extras:{...e.extras,meals:a},isDirty:!0}}),toggleInsurance:()=>e(e=>({extras:{...e.extras,insurance:e.extras.insurance?void 0:{enabled:!0,coverage:{tripCancellation:!0,tripInterruption:!0,medicalEmergency:!0,baggageLoss:!0,tripDelay:!0},premium:50,coverageAmount:1e4}},isDirty:!0})),updatePriorityBoarding:t=>e(e=>({extras:{...e.extras,priorityBoarding:t},isDirty:!0})),updateExtraLegroom:t=>e(e=>({extras:{...e.extras,extraLegroom:t},isDirty:!0})),updateWifiAccess:t=>e(e=>({extras:{...e.extras,wifiAccess:t},isDirty:!0})),updateLoungeAccess:t=>e(e=>({extras:{...e.extras,loungeAccess:t},isDirty:!0})),updatePayment:t=>e(e=>({payment:{...e.payment,...t},isDirty:!0})),setPaymentMethod:t=>e(e=>({payment:{...e.payment,method:t},isDirty:!0})),setPaymentAmount:t=>e(e=>({payment:{...e.payment,amount:t},isDirty:!0})),nextStep:()=>{let r=t();if(!r.validateCurrentStep())return!1;let s=o.indexOf(r.currentStep);if(s<o.length-1){let t=o[s+1];return e(e=>({currentStep:t,completedSteps:[...e.completedSteps,e.currentStep]})),!0}return!1},previousStep:()=>{let r=t(),s=o.indexOf(r.currentStep);s>0&&e({currentStep:o[s-1]})},goToStep:r=>{let s=t(),a=o.indexOf(s.currentStep);(o.indexOf(r)<=a||s.completedSteps.includes(r))&&e({currentStep:r})},markStepCompleted:t=>e(e=>({completedSteps:[...e.completedSteps,t]})),markStepIncomplete:t=>e(e=>({completedSteps:e.completedSteps.filter(e=>e!==t)})),validateStep:e=>{let r=t();switch(e){case"flights":return r.selectedFlights.length>0;case"passengers":return r.passengers.length>0&&r.passengers.every(e=>e.firstName&&e.lastName&&e.dateOfBirth&&e.gender);case"seats":case"extras":return!0;case"payment":return!!r.payment.method&&!!r.payment.amount;case"review":return r.validateAll();default:return!1}},validateCurrentStep:()=>{let e=t();return e.validateStep(e.currentStep)},validateAll:()=>{let e=t();return o.every(t=>e.validateStep(t))&&e.selectedFlights.length>0&&e.passengers.length>0},setValidationError:(t,r)=>e(e=>({validationErrors:{...e.validationErrors,[t]:[r]}})),clearValidationErrors:()=>e({validationErrors:{}}),clearFieldValidationError:t=>e(e=>{let r={...e.validationErrors};return delete r[t],{validationErrors:r}}),calculateTotal:()=>{let r=t(),s=r.basePrice,a=r.getSeatTotal(),i=r.getExtrasTotal(),n=Math.round((s+a)*.12);e({taxes:n,fees:25,totalAmount:s+a+i+n+25})},recalculatePricing:()=>{t().calculateTotal()},setCurrency:t=>e({currency:t}),saveDraft:async()=>{let r=t(),s=r.draftId||"draft_".concat(Date.now()),a={id:s,data:{selectedFlights:r.selectedFlights,passengers:r.passengers,seats:r.seats,extras:r.extras,payment:r.payment,currentStep:r.currentStep,completedSteps:r.completedSteps},lastSaved:new Date().toISOString()};return localStorage.setItem("booking_draft_".concat(s),JSON.stringify(a)),e({draftId:s,lastSaved:a.lastSaved,isDirty:!1}),s},loadDraft:async t=>{try{let r=localStorage.getItem("booking_draft_".concat(t));if(!r)return!1;let s=JSON.parse(r);return e({...s.data,draftId:s.id,lastSaved:s.lastSaved,isDirty:!1}),!0}catch(e){return console.error("Failed to load draft:",e),!1}},deleteDraft:async e=>{localStorage.removeItem("booking_draft_".concat(e)),t().draftId===e&&t().resetBooking()},enableAutoSave:()=>e({autoSaveEnabled:!0}),disableAutoSave:()=>e({autoSaveEnabled:!1}),clearBooking:()=>e({selectedFlights:[],passengers:[],seats:[],extras:{baggage:[],meals:[],insurance:void 0,priorityBoarding:!1,extraLegroom:!1,wifiAccess:!1,loungeAccess:!1,seatSelection:!1},payment:{},currentStep:"flights",completedSteps:[],validationErrors:{},isDirty:!1,basePrice:0,taxes:0,fees:0,totalAmount:0,status:"draft",bookingId:void 0,confirmationCode:void 0,pnr:void 0}),completeBooking:async()=>{let r=t();if(!r.validateAll())throw Error("Booking validation failed");let s={id:"booking_".concat(Date.now()),confirmationCode:"ABC123",pnr:"XYZ789",status:"confirmed",selectedFlights:r.selectedFlights,passengers:r.passengers,seats:r.seats,extras:r.extras,payment:r.payment,totalAmount:r.totalAmount,currency:r.currency};return e({bookingId:s.id,confirmationCode:s.confirmationCode,pnr:s.pnr,status:s.status}),s},confirmBooking:t=>e(e=>({...t,status:"confirmed",isDraft:!1})),resetBooking:()=>{t().clearBooking()},getTotalPassengers:()=>t().passengers.length,getTotalAdults:()=>t().passengers.filter(e=>e.dateOfBirth?new Date().getFullYear()-new Date(e.dateOfBirth).getFullYear()>=12:0).length,getTotalChildren:()=>t().passengers.filter(e=>{if(!e.dateOfBirth)return 0;let t=new Date().getFullYear()-new Date(e.dateOfBirth).getFullYear();return t>=2&&t<12}).length,getTotalInfants:()=>t().passengers.filter(e=>e.dateOfBirth?new Date().getFullYear()-new Date(e.dateOfBirth).getFullYear()<2:0).length,getSelectedFlightsTotal:()=>t().basePrice,getExtrasTotal:()=>{let e=t(),r=0;return e.extras.baggage&&(r+=e.extras.baggage.reduce((e,t)=>e+t.price,0)),e.extras.meals&&(r+=e.extras.meals.reduce((e,t)=>e+t.price,0)),e.extras.insurance&&(r+=50),e.extras.priorityBoarding&&(r+=25),e.extras.extraLegroom&&(r+=15*e.passengers.length),e.extras.wifiAccess&&(r+=10*e.passengers.length),e.extras.loungeAccess&&(r+=50*e.passengers.length),r},getSeatTotal:()=>t().seats.reduce((e,t)=>e+t.price,0),isComplete:()=>{let e=t();return e.selectedFlights.length>0&&e.passengers.length>0&&e.validateAll()},canProceedToNextStep:()=>t().validateCurrentStep(),getStepProgress:()=>t().completedSteps.length/o.length*100,getBookingSummary:()=>{let e=t();return{flights:e.selectedFlights,passengers:e.passengers,seats:e.seats,extras:e.extras,pricing:{basePrice:e.basePrice,taxes:e.taxes,fees:e.fees,extrasTotal:e.getExtrasTotal(),seatTotal:e.getSeatTotal(),totalAmount:e.totalAmount},status:e.status,confirmationCode:e.confirmationCode,currentStep:e.currentStep,progress:e.getStepProgress()}}}),{name:"booking-storage",partialize:e=>({selectedFlights:e.selectedFlights,passengers:e.passengers,seats:e.seats,extras:e.extras,currentStep:e.currentStep,completedSteps:e.completedSteps,currency:e.currency,autoSaveEnabled:e.autoSaveEnabled})})),c=(0,s.Ue)()((0,a.tJ)((e,t)=>({user:null,token:null,refreshToken:null,expiresAt:null,isAuthenticated:!1,isLoading:!1,error:null,sessionId:null,lastActivity:null,deviceFingerprint:null,twoFactorRequired:!1,twoFactorMethod:null,twoFactorBackupCodes:[],isResettingPassword:!1,resetToken:null,resetEmail:null,isVerifyingEmail:!1,verificationToken:null,socialProviders:{google:!1,facebook:!1,apple:!1},rememberMe:!1,autoLoginEnabled:!1,loginAttempts:0,lastFailedLogin:null,accountLocked:!1,lockUntil:null,requirePasswordChange:!1,passwordChangedAt:null,login:async function(r,s){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e({isLoading:!0,error:null});try{let n=t();if(n.accountLocked&&n.lockUntil&&new Date(n.lockUntil)>new Date)throw Error("Account is temporarily locked. Please try again later.");let o=await d(r,s);if(o.success&&o.data){let{user:t,tokens:r,session:s}=o.data;e({user:t,token:r.accessToken,refreshToken:r.refreshToken,expiresAt:new Date(Date.now()+1e3*r.expiresIn).toISOString(),isAuthenticated:!0,sessionId:s.id,lastActivity:new Date().toISOString(),rememberMe:a,loginAttempts:0,lastFailedLogin:null,accountLocked:!1,lockUntil:null,isLoading:!1,error:null})}else{var i;throw Error((null===(i=o.error)||void 0===i?void 0:i.message)||"Login failed")}}catch(r){let t=r instanceof Error?r.message:"Login failed";e(e=>({error:t,isLoading:!1,loginAttempts:e.loginAttempts+1,lastFailedLogin:new Date().toISOString(),accountLocked:e.loginAttempts>=4,lockUntil:e.loginAttempts>=4?new Date(Date.now()+9e5).toISOString():null}))}},logout:async()=>{try{let e=t();e.token&&e.sessionId&&await g(e.token,e.sessionId)}catch(e){console.error("Logout API error:",e)}finally{e({user:null,token:null,refreshToken:null,expiresAt:null,isAuthenticated:!1,sessionId:null,lastActivity:null,twoFactorRequired:!1,twoFactorMethod:null,error:null})}},register:async r=>{e({isLoading:!0,error:null});try{let e=await u(r);if(e.success)await t().login(r.email,r.password,!0);else{var s;throw Error((null===(s=e.error)||void 0===s?void 0:s.message)||"Registration failed")}}catch(t){e({error:t instanceof Error?t.message:"Registration failed",isLoading:!1})}},refreshAuthToken:async()=>{let r=t();if(!r.refreshToken){await t().logout();return}try{let s=await h(r.refreshToken);if(s.success){let{tokens:t}=s.data;e({token:t.accessToken,refreshToken:t.refreshToken,expiresAt:new Date(Date.now()+1e3*t.expiresIn).toISOString(),lastActivity:new Date().toISOString()})}else await t().logout()}catch(e){console.error("Token refresh failed:",e),await t().logout()}},verifyToken:async()=>{let e=t();if(!e.token)return!1;try{return(await p(e.token)).success}catch(e){return!1}},sendTwoFactorCode:async r=>{e({isLoading:!0,error:null});try{var s,a;let i=await m(r,null===(s=t().user)||void 0===s?void 0:s.email);if(i.success)e({twoFactorMethod:r,isLoading:!1});else throw Error((null===(a=i.error)||void 0===a?void 0:a.message)||"Failed to send verification code")}catch(t){e({error:t instanceof Error?t.message:"Failed to send code",isLoading:!1})}},verifyTwoFactorCode:async(t,r)=>{e({isLoading:!0,error:null});try{let a=await f(t,r);if(a.success)e({twoFactorRequired:!1,twoFactorMethod:null,isAuthenticated:!0,isLoading:!1});else{var s;throw Error((null===(s=a.error)||void 0===s?void 0:s.message)||"Invalid verification code")}}catch(t){e({error:t instanceof Error?t.message:"Invalid code",isLoading:!1})}},enableTwoFactor:async r=>{e({isLoading:!0,error:null});try{let a=await y(r);if(a.success)e({twoFactorRequired:!0,twoFactorMethod:r,user:t().user?{...t().user,twoFactorEnabled:!0}:null,isLoading:!1});else{var s;throw Error((null===(s=a.error)||void 0===s?void 0:s.message)||"Failed to enable two-factor authentication")}}catch(t){e({error:t instanceof Error?t.message:"Failed to enable 2FA",isLoading:!1})}},disableTwoFactor:async r=>{e({isLoading:!0,error:null});try{let a=await v(r);if(a.success)e({twoFactorRequired:!1,twoFactorMethod:null,twoFactorBackupCodes:[],user:t().user?{...t().user,twoFactorEnabled:!1}:null,isLoading:!1});else{var s;throw Error((null===(s=a.error)||void 0===s?void 0:s.message)||"Failed to disable two-factor authentication")}}catch(t){e({error:t instanceof Error?t.message:"Failed to disable 2FA",isLoading:!1})}},generateBackupCodes:async()=>{e({isLoading:!0,error:null});try{var t;let r=await w();if(r.success)return e({twoFactorBackupCodes:r.data.codes,isLoading:!1}),r.data.codes;throw Error((null===(t=r.error)||void 0===t?void 0:t.message)||"Failed to generate backup codes")}catch(t){return e({error:t instanceof Error?t.message:"Failed to generate codes",isLoading:!1}),[]}},forgotPassword:async t=>{e({isLoading:!0,error:null});try{let s=await S(t);if(s.success)e({isResettingPassword:!0,resetEmail:t,isLoading:!1});else{var r;throw Error((null===(r=s.error)||void 0===r?void 0:r.message)||"Failed to send reset email")}}catch(t){e({error:t instanceof Error?t.message:"Failed to send reset email",isLoading:!1})}},resetPassword:async(t,r)=>{e({isLoading:!0,error:null});try{let a=await F(t,r);if(a.success)e({isResettingPassword:!1,resetToken:null,resetEmail:null,isLoading:!1});else{var s;throw Error((null===(s=a.error)||void 0===s?void 0:s.message)||"Failed to reset password")}}catch(t){e({error:t instanceof Error?t.message:"Failed to reset password",isLoading:!1})}},changePassword:async(t,r)=>{e({isLoading:!0,error:null});try{let a=await k(t,r);if(a.success)e({requirePasswordChange:!1,passwordChangedAt:new Date().toISOString(),isLoading:!1});else{var s;throw Error((null===(s=a.error)||void 0===s?void 0:s.message)||"Failed to change password")}}catch(t){e({error:t instanceof Error?t.message:"Failed to change password",isLoading:!1})}},resendVerificationEmail:async()=>{e({isLoading:!0,error:null});try{var r,s;let a=await D(null===(r=t().user)||void 0===r?void 0:r.email);if(a.success)e({isLoading:!1});else throw Error((null===(s=a.error)||void 0===s?void 0:s.message)||"Failed to send verification email")}catch(t){e({error:t instanceof Error?t.message:"Failed to send email",isLoading:!1})}},verifyEmail:async r=>{e({isLoading:!0,error:null});try{let a=await x(r);if(a.success)e({user:t().user?{...t().user,isVerified:!0}:null,isVerifyingEmail:!1,verificationToken:null,isLoading:!1});else{var s;throw Error((null===(s=a.error)||void 0===s?void 0:s.message)||"Failed to verify email")}}catch(t){e({error:t instanceof Error?t.message:"Failed to verify email",isLoading:!1})}},loginWithGoogle:async t=>{if(t){e({user:{id:t.id,email:t.email,profile:{firstName:t.firstName,lastName:t.lastName,avatar:t.picture},isVerified:t.verified,provider:"google"},token:t.accessToken,expiresAt:new Date(t.expiresAt).toISOString(),isAuthenticated:!0,sessionId:"google_session_".concat(Date.now()),lastActivity:new Date().toISOString(),isLoading:!1,error:null});return}window.location.href="".concat("http://localhost:8082/api","/auth/google")},loginWithFacebook:async()=>{console.log("Facebook login is not available")},loginWithApple:async()=>{console.log("Apple login initiated")},linkSocialProvider:async e=>{console.log("Linking ".concat(e," account"))},unlinkSocialProvider:async e=>{console.log("Unlinking ".concat(e," account"))},updateProfile:async r=>{e({isLoading:!0,error:null});try{let a=await A(r);if(a.success)e({user:t().user?{...t().user,profile:{...t().user.profile,...r}}:null,isLoading:!1});else{var s;throw Error((null===(s=a.error)||void 0===s?void 0:s.message)||"Failed to update profile")}}catch(t){e({error:t instanceof Error?t.message:"Failed to update profile",isLoading:!1})}},updatePreferences:async r=>{e({isLoading:!0,error:null});try{let a=await P(r);if(a.success)e({user:t().user?{...t().user,preferences:{...t().user.preferences,...r}}:null,isLoading:!1});else{var s;throw Error((null===(s=a.error)||void 0===s?void 0:s.message)||"Failed to update preferences")}}catch(t){e({error:t instanceof Error?t.message:"Failed to update preferences",isLoading:!1})}},uploadAvatar:async r=>{e({isLoading:!0,error:null});try{let a=await E(r);if(a.success)e({user:t().user?{...t().user,profile:{...t().user.profile,avatar:a.data.url}}:null,isLoading:!1});else{var s;throw Error((null===(s=a.error)||void 0===s?void 0:s.message)||"Failed to upload avatar")}}catch(t){e({error:t instanceof Error?t.message:"Failed to upload avatar",isLoading:!1})}},updateSecuritySettings:async t=>{e({isLoading:!0,error:null});try{let s=await L(t);if(s.success)e({isLoading:!1});else{var r;throw Error((null===(r=s.error)||void 0===r?void 0:r.message)||"Failed to update security settings")}}catch(t){e({error:t instanceof Error?t.message:"Failed to update security",isLoading:!1})}},enableBiometric:async()=>{console.log("Biometric authentication enabled")},disableBiometric:async()=>{console.log("Biometric authentication disabled")},getSecurityLog:async()=>[],updateLastActivity:()=>{e({lastActivity:new Date().toISOString()})},extendSession:async()=>{await t().refreshAuthToken()},terminateAllSessions:async()=>{console.log("All sessions terminated"),await t().logout()},terminateSession:async e=>{console.log("Session ".concat(e," terminated"))},setLoading:t=>e({isLoading:t}),setError:t=>e({error:t}),clearError:()=>e({error:null}),setUser:t=>e({user:t}),setTokens:(t,r,s)=>e({token:t,refreshToken:r||null,expiresAt:s||null}),clearAuth:()=>e({user:null,token:null,refreshToken:null,expiresAt:null,isAuthenticated:!1,sessionId:null,lastActivity:null}),isTokenExpired:()=>{let{expiresAt:e}=t();return!e||new Date(e)<=new Date},isSessionExpired:()=>{let{lastActivity:e}=t();return!e||new Date(new Date(e).getTime()+18e5)<=new Date},shouldRenewToken:()=>{let{expiresAt:e}=t();return!!e&&new Date(new Date(e).getTime()-3e5)<=new Date},getAuthHeader:()=>{let{token:e}=t();return e?{Authorization:"Bearer ".concat(e)}:{}},hasPermission:e=>!0,isRole:e=>!0,getTimeUntilTokenExpiry:()=>{let{expiresAt:e}=t();return e?new Date(e).getTime()-Date.now():null},getTimeUntilSessionExpiry:()=>{let{lastActivity:e}=t();return e?new Date(e).getTime()+18e5-Date.now():null},getDaysSinceLastPasswordChange:()=>{let{passwordChangedAt:e}=t();return e?Math.floor((Date.now()-new Date(e).getTime())/864e5):1/0},getLoginStreak:()=>1,needsPasswordChange:()=>{let{getDaysSinceLastPasswordChange:e,requirePasswordChange:r}=t();return r||e()>90}}),{name:"auth-storage",storage:(0,a.FL)(()=>localStorage),partialize:e=>({token:e.token,refreshToken:e.refreshToken,expiresAt:e.expiresAt,user:e.user,isAuthenticated:e.isAuthenticated,rememberMe:e.rememberMe,autoLoginEnabled:e.autoLoginEnabled,twoFactorRequired:e.twoFactorRequired,twoFactorMethod:e.twoFactorMethod,twoFactorBackupCodes:e.twoFactorBackupCodes,socialProviders:e.socialProviders,sessionId:e.sessionId,lastActivity:e.lastActivity})}));async function d(e,t){if(await new Promise(e=>setTimeout(e,1e3)),e&&t&&t.length>=8){let t=e.split("@")[0];return{success:!0,data:{user:{id:"1",email:e,profile:{firstName:t.charAt(0).toUpperCase()+t.slice(1).split(".")[0],lastName:t.includes(".")?t.split(".")[1].charAt(0).toUpperCase()+t.split(".")[1].slice(1):"User"},isVerified:!0,twoFactorEnabled:!1},tokens:{accessToken:"mock-access-token-"+Date.now(),refreshToken:"mock-refresh-token-"+Date.now(),expiresIn:3600,tokenType:"Bearer"},session:{id:"mock-session-id-"+Date.now(),expiresAt:new Date(Date.now()+18e5).toISOString()}}}}return{success:!1,error:{message:"Invalid email or password. Password must be at least 8 characters.",code:"INVALID_CREDENTIALS"}}}async function g(e,t){return{success:!0}}async function u(e){return await new Promise(e=>setTimeout(e,1e3)),{success:!0}}async function h(e){return{success:!0,data:{tokens:{accessToken:"new-mock-access-token",refreshToken:"new-mock-refresh-token",expiresIn:3600}}}}async function p(e){return{success:!0}}async function m(e,t){return{success:!0}}async function f(e,t){return{success:!0}}async function y(e){return{success:!0}}async function v(e){return{success:!0}}async function w(){return{success:!0,data:{codes:["123456","789012","345678","901234"]}}}async function S(e){return{success:!0}}async function F(e,t){return{success:!0}}async function k(e,t){return{success:!0}}async function D(e){return{success:!0}}async function x(e){return{success:!0}}async function A(e){return{success:!0}}async function P(e){return{success:!0}}async function E(e){return{success:!0,data:{url:"https://example.com/avatar.jpg"}}}async function L(e){return{success:!0}}}}]);